{% extends "base.html" %}
{% block content %}
<div class="container">
  <h2 class="mb-3">➕ Adicionar Gasto</h2>

  <div class="card">
    <div class="card-body">
      <form method="post" action="{{ url_for('adicionar') }}">
        <div class="row g-3">
          <!-- Data -->
          <div class="col-12 col-md-4">
            <label class="form-label">Data</label>
            <input type="date" name="data" class="form-control" required>
          </div>

          <!-- Categoria (dinâmica) -->
          <div class="col-12 col-md-4">
            <label class="form-label">Categoria</label>
            <select id="categoria" name="categoria" class="form-select" required>
              <option value="">Selecione...</option>
              {% if categorias %}
                {% for cat in categorias %}
                  {% if cat %}
                    <option value="{{ cat }}">{{ cat }}</option>
                  {% endif %}
                {% endfor %}
              {% else %}
                <option value="Fixo">Fixo</option>
                <option value="Lazer">Lazer</option>
                <option value="Itens Casa">Itens Casa</option>
              {% endif %}
            </select>
          </div>

          <!-- Valor -->
          <div class="col-12 col-md-4">
            <label class="form-label">Valor</label>
            <input type="text" name="valor" class="form-control money-input" placeholder="R$ 0,00" required>
          </div>

          <!-- Descrição -->
          <div class="col-12">
            <label class="form-label">Descrição</label>
            <input type="text" name="descricao" class="form-control">
          </div>

          <!-- Gasto fixo (escondido até selecionar "Fixo") -->
          <div class="col-12" id="container-fixo" style="display: none;">
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox" value="1" id="replicar_fim_ano" name="replicar_fim_ano">
              <label class="form-check-label" for="replicar_fim_ano">
                Gasto fixo: <span class="text-muted">replicar mensalmente até dezembro do ano da data informada</span>
              </label>
            </div>
          </div>
        </div>

        <div class="d-flex gap-2 mt-3">
          <button class="btn btn-primary">Salvar</button>
          <a class="btn btn-outline-secondary" href="{{ url_for('listar_gastos') }}">Cancelar</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Exibir checkbox apenas se categoria for "Fixo"
  document.addEventListener("DOMContentLoaded", function() {
    const selectCat = document.getElementById("categoria");
    const boxFixo = document.getElementById("container-fixo");

    function toggleFixo() {
      const val = (selectCat.value || "").toLowerCase();
      if (val === "fixo") {
        boxFixo.style.display = "block";
      } else {
        boxFixo.style.display = "none";
        document.getElementById("replicar_fim_ano").checked = false;
      }
    }

    selectCat.addEventListener("change", toggleFixo);
    toggleFixo(); // inicializa estado ao carregar a página
  });
</script>
{% endblock %}
